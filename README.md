# Calimero Wireshark Hex Dump
A tool to listen on a KNX bus via TPUART and the Calimero Project suite and to dump the data from the packets into a Wireshark-compatible hex dump.


# Prerequisites

This tool is designed to work with the Calimero Java library and is compatible with a Raspberry Pi 3 or 4 and a Raspberry Pi HAT for the TPUART connection.

Here are some guides to getting the environment setup:

  1. Placeholder for Raspberry Pi HAT setup guide
  2. Placeholder for Calimero setup with Pi HAT
  
_Note: The next steps will assume that you setup your environment according to these guides._

# Usage
  
  ## Creating the Hex Dump
  1. Place the "Insert filename here" file into the _introduction/src/main/java/_ folder from the Calimero Project suite.

      Place image here

  3. Change into the _introduction_ folder.
      
      Place cd command image?

  3. To run the program, you can simply run:
      ```
      ./gradlew run -Pcalimero.serial.tpuart.maxInterByteDelay=60000 -Dmainclass=wiresharkTpuartHexDump
      ```
      
      
  4. Now, you wait for some messages to be transmitted on the bus and the dumped telegrams will be in the _wiresharkHexDumpedTelegrams.txt_ file.

  5. Cancel the tool using Ctrl-C and the file is now ready to be imported into Wireshark to be analyzed.


  ## Analyzing the Hex Dump 
  In Wireshark, you have the ability to import packets from a hex dump and specify a dissector to analyze the packet.
  
  1. Upon starting Wireshark, wait for the initial loading to finish. Then click _File -> Import From Hex Dump..._
      
      Insert Image here
      
  2. In order to properly parse this out, we need to give it a regular expression (regex) with some tags.
    
      ```
      ^\s*(?<time>\d{4}-\d\d\-\d\dT(\d\d\:){2}\d\d.(\d){6}[Z])\s(?<seqno>\d{6})\s+(?<data>[0-9a-fA-F]*)$
      ```
  
  3. Choose the hex dump file as the source.
      
      Insert image of the file textbox.
  
  4. Under the new dialog, change to the _Regular Expression_ tab and paste the regex into the box.
  
      Paste image here.
  
  5. Ensure that the data encoding is _Plain hex_
  
      Insert image here
  
  6. In the _Timestamp format_ textbox, we need to specify the pattern that is generated by the tool. 
  
      ```
      %Y-%m-%dT%H:%M:%S.%fZ
      ```
      _**NOTE: The timestamp format MUST be the EXACT SAME as this. Otherwise, there will not be a timestamp parsed out.**_
      
      Insert image here
  
  7. Under the _Encapsulation_ section, change _Encapsulation Type_ to _Wireshark Upper PDU Export_.
      
      Insert image here
  
  8. Check _ExportPDU_ to specify the _cemi_ dissector.
  
      Insert image here
  
  9. Now you're able to import the file and analyze the telegram.

# Sample Output

Here is a sample output of importing a hex dump generated by this tool.

Insert various pictures of an import and explain the different sections. Also, make note of the UTC normalization and sequence number error.



